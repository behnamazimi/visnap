---
title: Storybook Adapter
description: Test your Storybook stories with ViSnap
---

The Storybook adapter lets you test individual stories from your Storybook v8+ build. It's recommended way to use ViSnap.

## Configuration

```ts
// visnap.config.ts|js
testCase: [
  {
    name: "@visnap/storybook-adapter",
    options: {
      source: "./storybook-static",
      // port: 4477,
      // include: "*",
      // exclude: "*-skip*",
      // discovery: { evalTimeoutMs: 10000, maxRetries: 2, retryDelayMs: 200 },
    },
  },
];
```

<ApiTable
  title="Storybook Adapter Options"
  caption="Options are provided under adapters.testCase[i].options."
  sections={ApiTable.defineSections([
    {
      title: "General",
      rows: ApiTable.defineRows([
        {
          name: "source",
          type: "string",
          description:
            "Path or URL to your Storybook build. Must be non-empty.",
          href: "#source-options",
        },
        {
          name: "port",
          type: "number (>0)",
          description: "Port for local static server (when using local build).",
          href: "#source-options",
        },
        {
          name: "include",
          type: "string | string[]",
          description: "Minimatch patterns to include stories.",
          href: "#filtering-stories",
        },
        {
          name: "exclude",
          type: "string | string[]",
          description: "Minimatch patterns to exclude stories.",
          href: "#filtering-stories",
        },
      ]),
    },
    {
      title: "Discovery",
      rows: ApiTable.defineRows([
        {
          name: "discovery.evalTimeoutMs",
          type: "number (>0)",
          description: "Timeout for evaluating story metadata.",
        },
        {
          name: "discovery.maxRetries",
          type: "number (>=0)",
          description: "Number of retries for discovery.",
        },
        {
          name: "discovery.retryDelayMs",
          type: "number (>=0)",
          description: "Delay between discovery retries.",
        },
      ]),
    },
  ])}
  anchorPrefix="storybook"
/>

## Source Options

Use a local build directory (e.g., ./storybook-static) or a remote Storybook URL.

## Filtering Stories

Use minimatch patterns to control which stories are included or excluded.

## Custom Screenshot Targets

Target a specific element in the story by setting parameters.visualTesting.screenshotTarget.

## Story Configuration

Configure visual testing options directly in your stories:

```typescript
export default {
  title: "Button",
  component: Button,
  parameters: {
    visualTesting: {
      skip: false, // Skip this story
      screenshotTarget: "#storybook-root", // Custom screenshot target
      threshold: 0.05, // Custom threshold for this story
      browser: ["chromium", "firefox"], // Specific browsers
      viewport: { width: 1200, height: 800 }, // Custom viewport
      disableCSSInjection: true, // Disable global CSS injection
      interactions: [
        // Execute interactions before screenshot
        { type: "click", selector: "button" },
        { type: "fill", selector: "input", text: "test" },
      ],
    },
  },
};
```

## Story Parameters

### `skip`

Skip this story entirely:

```typescript
visualTesting: {
  skip: true;
}
```

### `screenshotTarget`

Specify which element to screenshot:

```typescript
visualTesting: {
  screenshotTarget: "#storybook-root"; // default
  // or
  screenshotTarget: ".my-component";
}
```

### `threshold`

Override the global threshold for this story:

```typescript
visualTesting: {
  threshold: 0.05; // 5% difference threshold
}
```

### `browser`

Test only specific browsers:

```typescript
visualTesting: {
  browser: ["chromium"]; // only test in Chromium
  // or
  browser: ["chromium", "firefox"]; // test in both
}
```

### `viewport`

Use a custom viewport for this story:

```typescript
visualTesting: {
  viewport: { width: 1200, height: 800 }
}
```

### `disableCSSInjection`

Disable global CSS injection for this story:

```typescript
visualTesting: {
  disableCSSInjection: true;
}
```

### `interactions`

Execute user interactions before taking the screenshot:

```typescript
visualTesting: {
  interactions: [
    { type: "click", selector: "button.primary" },
    { type: "fill", selector: 'input[name="email"]', text: "test@example.com" },
    { type: "waitForTimeout", duration: 500 },
    { type: "hover", selector: ".tooltip-trigger" },
  ];
}
```

### Mask elements

Overlay specific elements (without hiding them) to stabilize screenshots:

```typescript
export const WithStickyHeader: Story = {
  parameters: {
    visualTesting: {
      elementsToMask: [".sticky", "#ad-slot"],
    },
  },
};
```

Or, if you're using the [Playwright adapter](/docs/03-adapters/playwright-adapter), you can use the injectCSS option to hide or mask any elements you want with custom CSS.

## Common Use Cases

### Testing Form Interactions

```typescript
export const FilledForm: Story = {
  parameters: {
    visualTesting: {
      interactions: [
        {
          type: "fill",
          selector: 'input[name="email"]',
          text: "test@example.com",
        },
        {
          type: "fill",
          selector: 'input[name="password"]',
          text: "password123",
        },
        { type: "click", selector: 'button[type="submit"]' },
        { type: "waitForTimeout", duration: 1000 },
      ],
    },
  },
};
```

### Testing Hover States

```typescript
export const HoverState: Story = {
  parameters: {
    visualTesting: {
      interactions: [{ type: "hover", selector: ".button" }],
    },
  },
};
```

### Testing Loading States

```typescript
export const LoadingState: Story = {
  parameters: {
    visualTesting: {
      interactions: [
        { type: "click", selector: "button.load-data" },
        { type: "wait", selector: ".loading-spinner" },
        { type: "waitForTimeout", duration: 2000 },
      ],
    },
  },
};
```

## Troubleshooting

### Story Not Found

If stories aren't being discovered, ensure your Storybook build is up to date:

```npm
npm run build-storybook
```

### Port Conflicts

If port 4477 is already in use, you can change it in your config:

```typescript
options: {
  port: 4478; // use different port
}
```

### Stories Not Loading

If stories aren't loading, verify that your `source` path points to the correct Storybook build directory.
