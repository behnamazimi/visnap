---
title: API Reference
description: Programmatic usage of ViviDiff Core, Protocol types, and Reporter
---

Use ViviDiff programmatically in your applications and build custom tools.

## Core API

The `@vividiff/core` package provides the main programmatic interface.

### Installation

```bash
npm install @vividiff/core
```

### `runVisualTests(options)`

Run visual tests and compare with baseline images.

```typescript
import { runVisualTests } from '@vividiff/core';

const result = await runVisualTests({
  threshold: 0.1,
  screenshotDir: 'vividiff',
  adapters: {
    browser: {
      name: "@vividiff/playwright-adapter",
      options: { browser: 'chromium' }
    },
    testCase: [{
      name: "@vividiff/storybook-adapter",
      options: { source: "./storybook-static" }
    }]
  }
});

console.log(`Tests passed: ${result.success}`);
console.log(`Failed tests: ${result.failures.length}`);
```

**Parameters:**
- `threshold` - Pixel difference threshold (0.0 to 1.0)
- `screenshotDir` - Directory to save screenshots
- `adapters` - Browser and test case adapters
- `viewport` - Viewport configurations
- `runtime` - Runtime options

**Returns:**
```typescript
interface RunResult {
  success: boolean;
  total: number;
  passed: number;
  failed: number;
  failures: TestFailure[];
  duration: number;
}
```

### `updateBaseline(options)`

Capture baseline screenshots for all test cases.

```typescript
import { updateBaseline } from '@vividiff/core';

await updateBaseline({
  screenshotDir: 'vividiff',
  adapters: {
    browser: {
      name: "@vividiff/playwright-adapter",
      options: { browser: 'chromium' }
    },
    testCase: [{
      name: "@vividiff/storybook-adapter",
      options: { source: "./storybook-static" }
    }]
  }
});
```

### `initializeProject(options)`

Initialize a new project with configuration.

```typescript
import { initializeProject } from '@vividiff/core';

const result = await initializeProject({
  configType: 'ts',
  threshold: 0.1,
  screenshotDir: 'vividiff'
});

console.log(`Created: ${result.configPath}`);
```

## Protocol Types

The `@vividiff/protocol` package contains all TypeScript types and interfaces.

### Installation

```bash
npm install @vividiff/protocol
```

### Main Types

```typescript
import type {
  VisualTestingToolConfig,
  BrowserAdapter,
  TestCaseAdapter,
  ScreenshotOptions,
  ScreenshotResult,
  BrowserName,
  Viewport,
  RunOutcome,
  InteractionAction
} from '@vividiff/protocol';
```

### `VisualTestingToolConfig`

Main configuration interface:

```typescript
interface VisualTestingToolConfig {
  adapters: {
    browser: {
      name: string;
      options?: {
        browser?: BrowserConfiguration | BrowserConfiguration[];
        [key: string]: unknown;
      };
    };
    testCase: Array<{
      name: string;
      options?: Record<string, unknown>;
    }>;
  };
  threshold: number;
  screenshotDir?: string;
  runtime?: {
    maxConcurrency?: number;
    quiet?: boolean;
  };
  viewport?: Record<string, { width: number; height: number }>;
  comparison?: {
    core: 'odiff' | 'pixelmatch';
    threshold: number;
    diffColor?: string;
  };
  report: {
    html: boolean;
    json: boolean;
  };
}
```

### `BrowserAdapter`

Interface for browser automation:

```typescript
interface BrowserAdapter {
  init(options: BrowserInitOptions): Promise<void>;
  capture(options: ScreenshotOptions): Promise<ScreenshotResult>;
  dispose(): Promise<void>;
}
```

### `TestCaseAdapter`

Interface for test case discovery:

```typescript
interface TestCaseAdapter {
  start(): Promise<void>;
  listCases(page: Page, options: ListCasesOptions): Promise<TestCaseInstance[]>;
  stop(): Promise<void>;
}
```

### `ScreenshotOptions`

Options for screenshot capture:

```typescript
interface ScreenshotOptions {
  id: string;
  url: string;
  screenshotTarget?: string;
  viewport: { width: number; height: number };
  interactions?: InteractionAction[];
  threshold?: number;
}
```

### `InteractionAction`

User interaction types:

```typescript
type InteractionAction = 
  | { type: 'click'; selector: string; button?: 'left' | 'right' }
  | { type: 'doubleClick'; selector: string }
  | { type: 'fill'; selector: string; text: string }
  | { type: 'type'; selector: string; text: string }
  | { type: 'clear'; selector: string }
  | { type: 'hover'; selector: string }
  | { type: 'drag'; selector: string; target: string }
  | { type: 'keyPress'; key: string }
  | { type: 'waitForTimeout'; duration: number }
  | { type: 'waitForSelector'; selector: string }
  | { type: 'waitForText'; text: string }
  | { type: 'scroll'; selector: string; x: number; y: number }
  | { type: 'scrollToBottom'; selector: string }
  | { type: 'scrollToTop'; selector: string };
```

## Reporter API

The `@vividiff/reporter` package generates test reports.

### Installation

```bash
npm install @vividiff/reporter
```

### JSON Reporter

Generate machine-readable JSON reports:

```typescript
import { JsonReporter } from '@vividiff/reporter';

const reporter = new JsonReporter();
const result = await reporter.generate(testResult, {
  screenshotDir: './vividiff',
  pretty: true
});

console.log(`Report saved to: ${result}`);
```

**Options:**
- `outputPath?: string` - Output file path (optional)
- `screenshotDir: string` - Screenshot directory path
- `pretty?: boolean` - Pretty-print JSON (default: true)

### HTML Reporter

Generate interactive HTML reports:

```typescript
import { HtmlReporter } from '@vividiff/reporter';

const reporter = new HtmlReporter();
const result = await reporter.generate(testResult, {
  screenshotDir: './vividiff',
  title: 'My Test Report'
});

console.log(`HTML report saved to: ${result}`);
```

**Options:**
- `outputPath?: string` - Output file path (optional)
- `screenshotDir: string` - Screenshot directory path
- `title?: string` - Report title (default: "Vividiff Test Report")

### Complete Example

```typescript
import { runVisualTests } from '@vividiff/core';
import { JsonReporter, HtmlReporter } from '@vividiff/reporter';

async function runTestsWithReports() {
  // Run tests
  const result = await runVisualTests({
    threshold: 0.1,
    screenshotDir: './vividiff',
    adapters: {
      browser: {
        name: "@vividiff/playwright-adapter",
        options: { browser: 'chromium' }
      },
      testCase: [{
        name: "@vividiff/storybook-adapter",
        options: { source: "./storybook-static" }
      }]
    }
  });

  // Generate reports
  const jsonReporter = new JsonReporter();
  const htmlReporter = new HtmlReporter();

  const [jsonPath, htmlPath] = await Promise.all([
    jsonReporter.generate(result, {
      screenshotDir: './vividiff',
      pretty: true
    }),
    htmlReporter.generate(result, {
      screenshotDir: './vividiff',
      title: 'Test Results'
    })
  ]);

  console.log(`JSON report: ${jsonPath}`);
  console.log(`HTML report: ${htmlPath}`);
}
```

## Custom Adapters

Build your own adapters by implementing the required interfaces.

### Custom Browser Adapter

```typescript
import type { BrowserAdapter, ScreenshotOptions, ScreenshotResult } from '@vividiff/protocol';

class MyBrowserAdapter implements BrowserAdapter {
  async init(options: BrowserInitOptions): Promise<void> {
    // Initialize your browser
  }

  async capture(options: ScreenshotOptions): Promise<ScreenshotResult> {
    // Take screenshot
    return {
      path: './screenshot.png',
      width: options.viewport.width,
      height: options.viewport.height
    };
  }

  async dispose(): Promise<void> {
    // Cleanup
  }
}
```

### Custom Test Case Adapter

```typescript
import type { TestCaseAdapter, TestCaseInstance } from '@vividiff/protocol';

class MyTestCaseAdapter implements TestCaseAdapter {
  async start(): Promise<void> {
    // Start your test case source
  }

  async listCases(page: Page, options: ListCasesOptions): Promise<TestCaseInstance[]> {
    // Return list of test cases
    return [
      {
        id: 'test-1',
        url: '/test-1',
        title: 'Test 1',
        viewport: { width: 1920, height: 1080 }
      }
    ];
  }

  async stop(): Promise<void> {
    // Stop your test case source
  }
}
```

## Environment Variables

Control ViviDiff behavior with environment variables:

```bash
VIVIDIFF_SCREENSHOT_DIR=./screenshots
VIVIDIFF_THRESHOLD=0.05
VIVIDIFF_MAX_CONCURRENCY=8
VIVIDIFF_QUIET=true
```

## Error Handling

```typescript
import { runVisualTests } from '@vividiff/core';

try {
  const result = await runVisualTests(config);
  
  if (!result.success) {
    console.error(`Tests failed: ${result.failed}/${result.total}`);
    result.failures.forEach(failure => {
      console.error(`- ${failure.id}: ${failure.error}`);
    });
  }
} catch (error) {
  console.error('Test execution failed:', error.message);
}
```
